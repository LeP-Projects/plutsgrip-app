# ============================================================
# PRODUCTION ENVIRONMENT
# ============================================================
# Profile: prod (external DB + Nginx reverse proxy)
# Usage: docker compose --profile prod --env-file .env.prod up -d
# WARNING: CHANGE ALL VALUES BEFORE DEPLOYING TO PRODUCTION!
# ============================================================

# ==================== ENVIRONMENT ====================
APP_ENV=production
DEBUG=False

# ==================== DOCKER CONFIGURATION ====================
# Use production Dockerfiles with optimized builds
API_DOCKERFILE=Dockerfile
FRONTEND_DOCKERFILE=Dockerfile

# Port configuration
# In production, ports are internal only (Nginx exposes 80/443)
API_PORT=8000
FRONTEND_PORT=3000
FRONTEND_INTERNAL_PORT=3000

# Volume mode: ro (read-only) or omit for production
VOLUME_MODE=ro

# Restart policy for production
RESTART_POLICY=always

# ==================== DATABASE (EXTERNAL) ====================
# ⚠️ CRITICAL: Production uses EXTERNAL PostgreSQL database
# The postgres container is NOT included in prod profile
# Point DATABASE_URL to your external database (RDS, managed PostgreSQL, etc.)
#
# Format: postgresql://user:password@host:port/database
# Example: postgresql://prod_user:secure_pass@db.example.com:5432/plutusgrip_prod
DATABASE_URL=postgresql://PROD_USER:PROD_PASSWORD@EXTERNAL_DB_HOST:5432/plutusgrip_production

# These variables are NOT used in production (no postgres container)
# They are kept as placeholders for reference
POSTGRES_USER=CHANGE_THIS
POSTGRES_PASSWORD=CHANGE_THIS
POSTGRES_DB=CHANGE_THIS

# ==================== API CONFIGURATION ====================
# ⚠️ CRITICAL: Generate a new SECRET_KEY for production!
# Run: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=CHANGE_THIS_TO_SECURE_SECRET_KEY_GENERATED_VALUE
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# ⚠️ CRITICAL: Set to your actual production domain(s)
# Example: https://yourdomain.com,https://www.yourdomain.com,https://api.yourdomain.com
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# Database Pool - Production optimized (larger pool for concurrency)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=60
DB_POOL_RECYCLE=3600

# Logging
LOG_LEVEL=INFO

# ==================== FRONTEND ====================
# ⚠️ CRITICAL: Set to your actual production API domain
# Example: https://yourdomain.com/api or https://api.yourdomain.com
VITE_API_URL=https://yourdomain.com/api

# ==================== PGADMIN (NOT USED IN PROD) ====================
# pgAdmin is not included in production profile
# These variables are not used but kept for reference
# PGADMIN_EMAIL=admin@plutusgrip.com
# PGADMIN_PASSWORD=admin123

# ==================== RESOURCE LIMITS (PROD - STRICT) ====================
# Strict limits for production stability
API_CPU_LIMIT=1
API_MEMORY_LIMIT=1G
API_CPU_RESERVATION=0.5
API_MEMORY_RESERVATION=512M

FRONTEND_CPU_LIMIT=0.5
FRONTEND_MEMORY_LIMIT=512M
FRONTEND_CPU_RESERVATION=0.25
FRONTEND_MEMORY_RESERVATION=256M

# ==================== PRODUCTION DEPLOYMENT CHECKLIST ====================
# Before deploying, ensure you have:
# ✅ Set DATABASE_URL to external PostgreSQL database
# ✅ Generated and set secure SECRET_KEY
# ✅ Updated ALLOWED_ORIGINS with actual domain(s)
# ✅ Set VITE_API_URL to production API endpoint
# ✅ Configured SSL certificates in nginx/certs/ (optional but recommended)
# ✅ Uncommented HTTPS section in nginx/nginx.conf if using SSL
# ✅ Tested external database connection
# ✅ Set up database backups
# ✅ Configured monitoring and alerting
# ✅ Reviewed security best practices
